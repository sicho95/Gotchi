<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tamagotchi P1 Authentic</title>
    <style>
        /* Base Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: monospace;
            overflow: hidden;
            color: white;
        }

        /* HAMBURGER MENU */
        .hamburger { 
            position: fixed; top: 15px; left: 15px; z-index: 1000; cursor: pointer; 
            padding: 10px; background: #333; border-radius: 8px; border: 1px solid #555; 
        }
        .hamburger div { width: 25px; height: 3px; background: #fff; margin: 4px 0; border-radius: 2px; }
        .menu-dropdown { 
            display: none; position: fixed; top: 60px; left: 15px; background: #222; 
            border: 1px solid #555; border-radius: 8px; z-index: 1001; min-width: 180px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .menu-dropdown.active { display: block; }
        .menu-item { padding: 12px 15px; border-bottom: 1px solid #333; cursor: pointer; font-size: 14px; }
        .menu-item:hover { background: #333; }
        .menu-item:last-child { border-bottom: none; }
        .menu-item input { display: none; }

        /* DEVICE CONTAINER */
        .device-container {
            width: 340px;
            height: 420px;
            position: relative;
            /* Authentique violet */
            background: linear-gradient(135deg, #6a5acd 0%, #483d8b 100%);
            /* Forme d'oeuf P1 exacte */
            border-radius: 50% 50% 50% 50% / 60% 60% 45% 45%;
            box-shadow: 
                inset -8px -8px 20px rgba(0,0,0,0.5),
                inset 8px 8px 20px rgba(255,255,255,0.3),
                0 0 0 2px rgba(0,0,0,0.2),
                0 30px 60px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 55px;
        }

        /* LOOP (Porte-cl√©s) */
        .loop {
            position: absolute; top: -18px; left: 50%; transform: translateX(-50%);
            width: 50px; height: 50px; border-radius: 50%; border: 6px solid #aaa;
            z-index: -1;
        }

        /* BRANDING */
        .brand {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            font-weight: bold;
            font-size: 24px;
            letter-spacing: 2px;
            color: #fff;
            margin-bottom: 20px;
            text-shadow: 0 2px 3px rgba(0,0,0,0.4);
            transform: scaleY(0.9);
        }

        /* SCREEN BEZEL (Gris clair) */
        .screen-bezel {
            background: #e0e0e0;
            width: 220px;
            height: 220px;
            border-radius: 25px; /* Arrondi authentique */
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 
                inset 2px 2px 5px rgba(0,0,0,0.1),
                0 4px 8px rgba(0,0,0,0.3);
            margin-bottom: 25px;
            position: relative;
        }

        /* LCD SCREEN (Vert) */
        .lcd {
            width: 160px; height: 160px;
            background-color: #839150; /* Vert olive authentique */
            border: 2px solid #6b7740;
            border-radius: 6px;
            position: relative;
            image-rendering: pixelated;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2);
        }

        /* Scanlines */
        .lcd::after {
            content: " "; display: block; position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 2px;
            pointer-events: none;
            z-index: 5;
        }

        /* ICONS ROWS */
        .icons-row {
            display: flex;
            justify-content: space-between;
            padding: 2px 5px;
            background: rgba(0,0,0,0.05);
            height: 24px;
            z-index: 10;
        }
        .icons-row.top { border-bottom: 1px solid rgba(0,0,0,0.1); }
        .icons-row.bottom { border-top: 1px solid rgba(0,0,0,0.1); }

        /* EMOJI ICONS (Black, Simple, Authentic Look) */
        .icon {
            width: 20px; height: 20px;
            font-size: 16px;
            line-height: 20px;
            text-align: center;
            opacity: 0.25;
            filter: grayscale(100%) contrast(200%); /* Noir pur */
            cursor: pointer;
            position: relative;
        }
        .icon.active { opacity: 1; transform: scale(1.1); }

        /* Triangle indicator for selection */
        .icon.selected::after {
            content: ''; position: absolute; left: 50%; transform: translateX(-50%);
            border: 4px solid transparent;
        }
        .top .icon.selected::after { top: 20px; border-top-color: #000; }
        .bottom .icon.selected::after { bottom: 20px; border-bottom-color: #000; }

        /* MAIN GAME AREA */
        .game-stage {
            flex: 1; position: relative;
            display: flex; justify-content: center; align-items: center;
        }

        /* BUTTONS AREA (Inside the egg shape) */
        .buttons-area {
            display: flex; gap: 30px;
            margin-bottom: 40px; /* Remonte pour √™tre dans la coque */
        }

        .btn-group { position: relative; width: 50px; height: 50px; }

        .phys-btn {
            width: 100%; height: 100%;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 
                0 4px 0 #999, 
                0 8px 10px rgba(0,0,0,0.3),
                inset 0 2px 5px rgba(255,255,255,0.4);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .phys-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #999, inset 0 2px 5px rgba(0,0,0,0.2); }

        .b-yellow { background: #f4d03f; }
        .b-red { background: #e74c3c; }
        .b-blue { background: #3498db; }

        .btn-label {
            position: absolute; bottom: -22px; width: 100%; text-align: center;
            font-size: 10px; font-weight: bold; color: #ccc; letter-spacing: 1px;
            font-family: sans-serif;
        }

        /* TEXT DISPLAY (Pixel Font) */
        .lcd-msg {
            position: absolute; width: 100%; text-align: center; top: 10px;
            font-family: 'Courier New', monospace; font-weight: bold; font-size: 12px;
            color: #000; display: none; z-index: 20; background: rgba(131, 145, 80, 0.9);
        }
        .lcd-msg.show { display: block; }

        /* SPRITES (CSS Pixel Art) */
        .sprite {
            width: 48px; height: 48px;
            image-rendering: pixelated;
            background-size: contain; background-repeat: no-repeat;
        }

        /* EGG */
        .s-egg { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath d='M6 2h4v2h2v2h2v6h-2v2h-2v2H6v-2H4v-2H2V6h2V4h2V2zm1 2v2h2V4H7zm-2 2v2h2V6H5zm4 0v2h2V6H9zm-4 2v2h2V8H5zm4 0v2h2V8H9zm-4 2v2h2v-2H5zm4 0v2h2v-2H9z' fill='%23000'/%3E%3C/svg%3E"); }
        /* BABY */
        .s-baby { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath d='M6 4h4v2h2v6h-2v2H6v-2H4V6h2V4zm1 3h1v1H7V7zm3 0h1v1h-1V7zm-2 3h2v1H8v-1z' fill='%23000'/%3E%3C/svg%3E"); }
        /* ADULT (Maskutchi) */
        .s-adult { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath d='M4 2h8v2h2v8h-2v2H4v-2H2V4h2V2zm2 3h2v2H6V5zm4 0h2v2h-2V5zm-4 4h8v2H6V9z' fill='%23000'/%3E%3C/svg%3E"); }
        /* POOP */
        .poop { position: absolute; bottom: 5px; right: 5px; width: 16px; height: 16px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath d='M4 8h8v2H4zm2-2h4v2H6zm1 4h2v2H7z' fill='%23000'/%3E%3C/svg%3E"); background-size: contain; }

    </style>
</head>
<body>

    <div class="hamburger" onclick="toggleSysMenu()"><div></div><div></div><div></div></div>
    <div class="menu-dropdown" id="sysMenu">
        <div class="menu-item" onclick="setSkin('purple')">üü£ Violet</div>
        <div class="menu-item" onclick="setSkin('blue')">üîµ Bleu</div>
        <div class="menu-item" onclick="setSkin('white')">‚ö™ Blanc</div>
        <div class="menu-item" onclick="saveData()">üíæ Save</div>
        <label class="menu-item">üìÇ Load <input type="file" onchange="loadData(this)"></label>
        <div class="menu-item" onclick="resetData()">üîÑ Reset</div>
    </div>

    <div class="device-container" id="device">
        <div class="loop"></div>
        <div class="brand">GOTCHI</div>

        <div class="screen-bezel">
            <div class="lcd">
                <div class="icons-row top">
                    <div class="icon" id="i0">üçΩÔ∏è</div>
                    <div class="icon" id="i1">üí°</div>
                    <div class="icon" id="i2">üèè</div>
                    <div class="icon" id="i3">üíâ</div>
                </div>

                <div class="game-stage">
                    <div class="lcd-msg" id="msg"></div>
                    <div id="sprite" class="sprite s-egg"></div>
                    <div id="poops"></div>
                </div>

                <div class="icons-row bottom">
                    <div class="icon" id="i4">ü¶Ü</div>
                    <div class="icon" id="i5">‚öñÔ∏è</div>
                    <div class="icon" id="i6">üò†</div>
                    <div class="icon" id="i7">‚ö†Ô∏è</div>
                </div>
            </div>
        </div>

        <div class="buttons-area">
            <div class="btn-group">
                <button class="phys-btn b-yellow" onmousedown="input('A')"></button>
                <div class="btn-label">SELECT</div>
            </div>
            <div class="btn-group">
                <button class="phys-btn b-red" onmousedown="input('B')"></button>
                <div class="btn-label">DECIDE</div>
            </div>
            <div class="btn-group">
                <button class="phys-btn b-blue" onmousedown="input('C')"></button>
                <div class="btn-label">CANCEL</div>
            </div>
        </div>
    </div>

    <script>
        const STATE = {
            stage: 'egg', // egg, baby, adult
            birth: Date.now(),
            hunger: 2,
            happy: 2,
            weight: 5,
            poops: 0,
            sick: false,
            menuIdx: -1, // 0-7
            lightOn: true,
            view: 'game' // game, stats
        };

        // LOOP
        setInterval(() => {
            const now = Date.now();

            // Hatch
            if(STATE.stage === 'egg' && now - STATE.birth > 10000) { // 10s for demo
                STATE.stage = 'baby';
                uiMsg("HATCHED!");
            }

            // Needs
            if(STATE.stage !== 'egg') {
                if(Math.random() < 0.02) STATE.hunger = Math.max(0, STATE.hunger - 1);
                if(Math.random() < 0.02) STATE.happy = Math.max(0, STATE.happy - 1);
                if(Math.random() < 0.01) STATE.poops = Math.min(4, STATE.poops + 1);
            }

            render();
            // Auto Save
            localStorage.setItem('vpet_save', JSON.stringify(STATE));
        }, 1000);

        // RENDER
        function render() {
            // Icons
            for(let i=0; i<8; i++) {
                const el = document.getElementById('i'+i);
                el.classList.remove('selected', 'active');
                if(STATE.menuIdx === i) el.classList.add('selected'); // Arrow
            }
            // Attention Icon
            if(STATE.hunger===0 || STATE.happy===0 || STATE.poops>2 || STATE.sick) {
                document.getElementById('i7').classList.add('active');
            }

            // Sprite
            const s = document.getElementById('sprite');
            s.className = 'sprite s-' + STATE.stage;
            // Wiggle Animation
            s.style.transform = (Date.now() % 1000 < 500) ? 'translateX(-1px)' : 'translateX(1px)';

            // Poops
            const pZone = document.getElementById('poops');
            pZone.innerHTML = '';
            for(let i=0; i<STATE.poops; i++) {
                let p = document.createElement('div');
                p.className = 'poop';
                p.style.right = (i*15) + 'px';
                pZone.appendChild(p);
            }
        }

        // INPUT
        function input(btn) {
            if(STATE.stage === 'egg') return;

            if(btn === 'A') {
                // Cycle Menu
                if(STATE.menuIdx === -1) STATE.menuIdx = 0;
                else STATE.menuIdx = (STATE.menuIdx + 1) % 8;
            }

            if(btn === 'B') {
                // Confirm
                if(STATE.menuIdx === -1) {
                    toggleStats(); // No menu selected -> Stats
                } else {
                    doAction(STATE.menuIdx);
                }
            }

            if(btn === 'C') {
                // Cancel
                STATE.menuIdx = -1;
                uiMsg(""); // Clear msg
            }
            render();
        }

        function doAction(idx) {
            switch(idx) {
                case 0: // Eat
                    uiMsg("MEAL...");
                    setTimeout(() => { STATE.hunger=4; STATE.weight++; uiMsg(""); STATE.menuIdx=-1; }, 1000);
                    break;
                case 1: // Light
                    STATE.lightOn = !STATE.lightOn;
                    STATE.menuIdx = -1;
                    break;
                case 2: // Game
                    uiMsg("WIN!");
                    STATE.happy=4; STATE.weight--; STATE.menuIdx=-1;
                    setTimeout(() => uiMsg(""), 1000);
                    break;
                case 3: // Meds
                    if(STATE.sick) { STATE.sick=false; uiMsg("OK"); }
                    STATE.menuIdx = -1;
                    break;
                case 4: // Flush
                    STATE.poops = 0; uiMsg("CLEAN"); STATE.menuIdx = -1;
                    setTimeout(() => uiMsg(""), 1000);
                    break;
                case 5: // Stats
                    toggleStats();
                    STATE.menuIdx = -1;
                    break;
            }
        }

        function toggleStats() {
            const el = document.getElementById('msg');
            if(el.innerText.includes("AGE")) el.innerText = "";
            else {
                const age = Math.floor((Date.now() - STATE.birth)/60000); // Minutes for demo
                el.innerText = `AGE:${age} W:${STATE.weight}g
Hunger:${STATE.hunger}/4`;
                el.style.display = 'block';
            }
        }

        function uiMsg(txt) {
            const el = document.getElementById('msg');
            el.innerText = txt;
            el.style.display = txt ? 'block' : 'none';
        }

        // SYSTEM
        function toggleSysMenu() { document.getElementById('sysMenu').classList.toggle('active'); }
        function setSkin(c) {
            const d = document.getElementById('device');
            if(c==='purple') d.style.background='linear-gradient(135deg, #6a5acd, #483d8b)';
            if(c==='blue') d.style.background='linear-gradient(135deg, #4682b4, #1e90ff)';
            if(c==='white') d.style.background='#f0f0f0';
            toggleSysMenu();
        }
        function saveData() { 
            const blob = new Blob([JSON.stringify(STATE)], {type:'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='gotchi.json'; a.click();
        }
        function loadData(el) {
            const r = new FileReader();
            r.onload = e => Object.assign(STATE, JSON.parse(e.target.result));
            r.readAsText(el.files[0]);
        }
        function resetData() { localStorage.removeItem('vpet_save'); location.reload(); }

        // INIT
        const sv = localStorage.getItem('vpet_save');
        if(sv) Object.assign(STATE, JSON.parse(sv));
        render();

    </script>
</body>
</html>