<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tamagotchi Original</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
        }

        /* Menu hamburger */
        .hamburger-menu {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .hamburger-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 8px;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
            padding: 8px;
            transition: all 0.2s;
        }

        .hamburger-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .hamburger-btn span {
            width: 24px;
            height: 3px;
            background: #fff;
            border-radius: 2px;
        }

        .menu-dropdown {
            display: none;
            position: absolute;
            top: 55px;
            left: 0;
            background: #222;
            border: 1px solid #444;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-width: 200px;
            overflow: hidden;
            z-index: 1001;
            color: #fff;
        }

        .menu-dropdown.active {
            display: block;
        }

        .menu-item {
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid #333;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .menu-item:hover {
            background: #333;
        }

        /* Device Tamagotchi - Forme d'oeuf corrigÃ©e */
        .tamagotchi-device {
            background: var(--shell-color, linear-gradient(135deg, #6a5acd, #483d8b));
            /* Forme d'oeuf plus rÃ©aliste: plus pointu en haut, plus large en bas */
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            width: 360px;
            height: 440px;
            padding: 45px 35px 60px 35px;
            box-shadow: 
                inset -10px -10px 20px rgba(0,0,0,0.3),
                inset 10px 10px 20px rgba(255,255,255,0.3),
                0 20px 50px rgba(0,0,0,0.5);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background 0.3s;
        }

        /* Attache porte-clÃ© */
        .tamagotchi-device::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: radial-gradient(circle at 30% 30%, #ddd, #888);
            border-radius: 50%;
            border: 2px solid #666;
            z-index: 2;
        }

        .logo-area {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            font-weight: bold;
            font-size: 24px;
            color: rgba(255,255,255,0.9);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            margin-bottom: 15px;
            margin-top: 10px;
            letter-spacing: 1px;
            transform: scaleY(0.9);
        }

        /* Ã‰cran LCD */
        .screen-container {
            background: #d0d0d0;
            border-radius: 15px;
            padding: 15px;
            width: 240px;
            height: 240px;
            box-shadow: 
                inset 2px 2px 5px rgba(0,0,0,0.2),
                1px 1px 2px rgba(255,255,255,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
        }

        .screen-glass {
            background: #8b9c46; /* Vert LCD authentique */
            width: 100%;
            height: 100%;
            border: 2px solid #555;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 3px 3px 8px rgba(0,0,0,0.2);
            image-rendering: pixelated;
        }

        /* Grille de pixels de fond (optionnel pour rÃ©alisme) */
        .screen-glass::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
            z-index: 10;
        }

        /* Menus Haut et Bas */
        .menu-bar {
            position: absolute;
            left: 0;
            right: 0;
            height: 24px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: rgba(0,0,0,0.05);
            z-index: 5;
            padding: 0 5px;
        }

        .menu-top { top: 0; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .menu-bottom { bottom: 0; border-top: 1px solid rgba(0,0,0,0.1); }

        .menu-icon {
            width: 20px;
            height: 20px;
            opacity: 0.3;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
        }

        .menu-icon.selected {
            opacity: 1;
            filter: drop-shadow(0 0 1px rgba(0,0,0,0.5));
        }

        /* Indicateur de sÃ©lection (triangle) */
        .menu-icon.selected::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
        }

        /* Triangle haut pour menu bas, triangle bas pour menu haut */
        .menu-top .menu-icon.selected::before {
            top: 22px;
            border-top-color: #111;
        }
        .menu-bottom .menu-icon.selected::before {
            bottom: 22px;
            border-bottom-color: #111;
        }

        /* SVG Icons Data URIs - Pixel Art Authentique */
        .icon-feed { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M3 2h2v6H3zm0 7h2v5H3zm6-7h2v6H9zm0 7h2v5H9z"/></svg>'); } /* Fourchette Couteau */
        .icon-light { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M6 1h4v2H6zm-2 3h8v6H4zm3 7h2v2H7z"/></svg>'); } /* Ampoule */
        .icon-game { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M2 5h12v6H2zm2-2h2v2H4zm8 0h2v2h-2z"/></svg>'); } /* Batte/Jeu */
        .icon-meds { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M2 8h4v4H2zm5-4h2v8H7zm3-2h4v4h-4z"/></svg>'); } /* Seringue */
        .icon-bath { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M2 6h4v4H2zm5 2h7v2H7zm0 3h5v3H7z"/></svg>'); } /* Canard */
        .icon-scale { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M2 2h12v10H2zm2 2h8v4H4z"/></svg>'); } /* Balance */
        .icon-disc { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M2 2h12v12H2zm2 2h2v2H4zm6 0h2v2h-2zm-4 6h4v2H6z"/></svg>'); } /* Visage */
        .icon-attn { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M6 2h4v12H6zm2 2h2v2H8zm0 8h2v2H8z"/></svg>'); } /* Attention */

        /* Zone de jeu centrale */
        .game-area {
            position: absolute;
            top: 26px;
            bottom: 26px;
            left: 2px;
            right: 2px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Sprite du personnage */
        .sprite {
            width: 48px;
            height: 48px;
            image-rendering: pixelated;
            background-repeat: no-repeat;
            background-size: contain;
            /* Animation "Wiggle" authentique (pas de rebond) */
            animation: wiggle 1s steps(2) infinite;
        }

        @keyframes wiggle {
            0% { transform: translateX(0); }
            50% { transform: translateX(2px); }
        }

        /* Sprites SVG authentiques (mais refaits) */
        /* Egg: damier */
        .sprite.egg { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M6 2h4v2h2v2h2v6h-2v2h-2v2H6v-2H4v-2H2V6h2V4h2V2zm1 2v2h2V4H7zm-2 2v2h2V6H5zm4 0v2h2V6H9zm-4 2v2h2V8H5zm4 0v2h2V8H9zm-4 2v2h2v-2H5zm4 0v2h2v-2H9z"/></svg>'); }
        /* Baby: petite boule noire */
        .sprite.baby { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M6 4h4v2h2v6h-2v2H6v-2H4V6h2V4zm1 3h1v1H7V7zm3 0h1v1h-1V7zm-2 3h2v1H8v-1z"/></svg>'); }
        /* Child: rond avec pattes */
        .sprite.child { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M5 4h6v2h2v6h-2v2h-2v2H7v-2H5v-2H3V6h2V4zm2 2h2v2H7V6zm-2 2h1v1H5V8zm6 0h1v1h-1V8z"/></svg>'); }
        /* Teen: forme de canard bizarre */
        .sprite.teen { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M4 4h4v2h2v-2h2v2h2v6h-2v2h-4v-2H6v2H4v-2H2V6h2V4zm2 3h2v2H6V7zm6 0h2v2h-2V7z"/></svg>'); }
        /* Adult: masque (Maskutchi style) */
        .sprite.adult { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M4 2h8v2h2v8h-2v2H4v-2H2V4h2V2zm2 3h2v2H6V5zm4 0h2v2h-2V5zm-4 4h8v2H6V9z"/></svg>'); }
        /* Skull */
        .sprite.dead { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M4 3h8v3h2v5h-2v2H4v-2H2V6h2V3zm3 2h2v2H7V5zm-2 2h1v1H5V7zm6 0h1v1h-1V7zm-4 3h2v2H7v-2z"/></svg>'); }

        .poop {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 16px;
            height: 16px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="black" d="M4 8h8v2H4zm2-2h4v2H6zm1 4h2v2H7z"/></svg>');
        }

        /* Overlay d'information (Stats, Heure, etc.) */
        .info-overlay {
            position: absolute;
            top: 25px; bottom: 25px; left: 0; right: 0;
            background: #8b9c46;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            font-size: 12px;
            z-index: 100;
        }
        .info-overlay.active { display: flex; }

        .hearts-row { display: flex; gap: 2px; margin-bottom: 5px; }
        .heart { width: 8px; height: 8px; border: 1px solid black; }
        .heart.full { background: black; }

        /* Boutons Physiques */
        .buttons-container {
            display: flex;
            gap: 25px;
            margin-top: 10px;
        }

        .tama-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b); /* Jaune par dÃ©faut */
            box-shadow: 
                0 5px 0 #888,
                0 10px 10px rgba(0,0,0,0.3),
                inset 2px 2px 5px rgba(255,255,255,0.4);
            cursor: pointer;
            position: relative;
            top: 0;
            transition: top 0.1s, box-shadow 0.1s;
        }

        .tama-btn:active {
            top: 4px;
            box-shadow: 
                0 1px 0 #888,
                0 4px 4px rgba(0,0,0,0.3),
                inset 2px 2px 5px rgba(255,255,255,0.4);
        }

        .btn-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: bold;
            color: #ccc;
            letter-spacing: 1px;
        }

        /* Couleurs boutons spÃ©cifiques */
        .btn-a { background: radial-gradient(circle at 30% 30%, #f0e68c, #bdb76b); }
        .btn-b { background: radial-gradient(circle at 30% 30%, #ffa07a, #cd5c5c); }
        .btn-c { background: radial-gradient(circle at 30% 30%, #87cefa, #4682b4); }

    </style>
</head>
<body>

    <div class="hamburger-menu">
        <button class="hamburger-btn" onclick="toggleMenu()">
            <span></span><span></span><span></span>
        </button>
        <div class="menu-dropdown" id="menu">
            <div class="menu-item" onclick="saveGame()">ðŸ’¾ Sauvegarder</div>
            <label class="menu-item">ðŸ“‚ Charger <input type="file" hidden onchange="loadGame(this)"></label>
            <div class="menu-item" onclick="resetGame()">ðŸ”„ Reset</div>
            <div class="menu-item" onclick="changeColor('purple')">ðŸŸ£ Violet</div>
            <div class="menu-item" onclick="changeColor('blue')">ðŸ”µ Bleu</div>
            <div class="menu-item" onclick="changeColor('white')">âšª Blanc</div>
            <div class="menu-item" onclick="changeColor('trans_pink')">ðŸŒ¸ Rose Trans</div>
        </div>
    </div>

    <div class="tamagotchi-device" id="device">
        <div class="logo-area">TAMAGOTCHI</div>

        <div class="screen-container">
            <div class="screen-glass" id="screen">

                <!-- Menu Haut -->
                <div class="menu-bar menu-top">
                    <div class="menu-icon icon-feed" id="icon-0"></div>
                    <div class="menu-icon icon-light" id="icon-1"></div>
                    <div class="menu-icon icon-game" id="icon-2"></div>
                    <div class="menu-icon icon-meds" id="icon-3"></div>
                </div>

                <!-- Zone de Jeu -->
                <div class="game-area">
                    <div id="sprite" class="sprite egg"></div>
                    <div id="poop-container"></div>
                </div>

                <!-- Overlay Stats/Info -->
                <div class="info-overlay" id="overlay">
                    <div id="overlay-content"></div>
                </div>

                <!-- Menu Bas -->
                <div class="menu-bar menu-bottom">
                    <div class="menu-icon icon-bath" id="icon-4"></div>
                    <div class="menu-icon icon-scale" id="icon-5"></div>
                    <div class="menu-icon icon-disc" id="icon-6"></div>
                    <div class="menu-icon icon-attn" id="icon-7"></div>
                </div>

            </div>
        </div>

        <div class="buttons-container">
            <button class="tama-btn btn-a" onclick="btnA()"><span class="btn-label">SELECT</span></button>
            <button class="tama-btn btn-b" onclick="btnB()"><span class="btn-label">DECIDE</span></button>
            <button class="tama-btn btn-c" onclick="btnC()"><span class="btn-label">CANCEL</span></button>
        </div>
    </div>

    <script>
        /* --- LOGIQUE DU JEU --- */
        let state = {
            stage: 'egg', // egg, baby, child, teen, adult, dead
            birthTime: Date.now(),
            lastUpdate: Date.now(),
            hunger: 0, // 0-4 (0=vide, 4=plein) - Attention logique inversÃ©e parfois, ici 4=rassasiÃ©
            happiness: 0, // 0-4
            weight: 5,
            discipline: 0,
            poop: 0,
            sick: false,
            sleeping: false,
            lights: true,
            menuIdx: -1, // -1=aucun, 0-7
            subState: 'idle' // idle, menu, eating, gaming, sleeping
        };

        const config = {
            eggHatchTime: 60000, // 1 minute
            tickRate: 10000, // Check updates every 10s
        };

        // UI Update
        function updateUI() {
            // Sprite
            const spriteEl = document.getElementById('sprite');
            spriteEl.className = `sprite ${state.stage}`;

            // Poop
            const poopCont = document.getElementById('poop-container');
            poopCont.innerHTML = '';
            for(let i=0; i<state.poop; i++) {
                const p = document.createElement('div');
                p.className = 'poop';
                p.style.right = (5 + i*20) + 'px';
                poopCont.appendChild(p);
            }

            // Menu Selection
            document.querySelectorAll('.menu-icon').forEach((el, idx) => {
                if(state.menuIdx === idx) el.classList.add('selected');
                else el.classList.remove('selected');
            });

            // Light Check
            const glass = document.getElementById('screen');
            if(!state.lights) glass.style.backgroundColor = '#445';
            else glass.style.backgroundColor = '#8b9c46';
        }

        // Game Loop
        function loop() {
            const now = Date.now();

            // Hatching
            if(state.stage === 'egg') {
                if(now - state.birthTime > config.eggHatchTime) {
                    state.stage = 'baby';
                    state.hunger = 1;
                    state.happiness = 1;
                    alert("Eclosion !");
                }
            } else if (state.stage !== 'dead') {
                // Hunger/Happy drop simulation (very simple)
                if(Math.random() < 0.05) state.hunger = Math.max(0, state.hunger - 1);
                if(Math.random() < 0.05) state.happiness = Math.max(0, state.happiness - 1);

                // Poop random
                if(Math.random() < 0.02) state.poop = Math.min(4, state.poop + 1);

                // Sleep logic (21h - 8h)
                const h = new Date().getHours();
                if(h >= 21 || h < 8) state.sleeping = true;
                else state.sleeping = false;
            }

            saveLocal();
            updateUI();
        }

        // Buttons
        function btnA() {
            if(state.stage === 'egg' || state.stage === 'dead') return;
            // Cycle menu 0-7
            if(state.menuIdx === -1) state.menuIdx = 0;
            else state.menuIdx = (state.menuIdx + 1) % 8;
            updateUI();
        }

        function btnB() {
            if(state.stage === 'egg' || state.stage === 'dead') return;
            if(state.menuIdx === -1) {
                // Show clock or stats if no menu selected (Clock not impl, show Stats)
                showStats();
            } else {
                executeMenu(state.menuIdx);
            }
        }

        function btnC() {
            // Cancel / Back
            state.menuIdx = -1;
            hideOverlay();
            updateUI();
        }

        // Actions
        function executeMenu(idx) {
            switch(idx) {
                case 0: // Feed
                    state.hunger = Math.min(4, state.hunger + 1);
                    state.weight++;
                    animateAction('Miam!');
                    break;
                case 1: // Light
                    state.lights = !state.lights;
                    updateUI();
                    break;
                case 2: // Game (simple guess)
                    let guess = confirm("Gauche (OK) ou Droite (Cancel) ?");
                    let win = Math.random() > 0.5;
                    if(win) {
                        state.happiness = Math.min(4, state.happiness + 1);
                        state.weight = Math.max(1, state.weight - 1);
                        alert("GagnÃ© !");
                    } else {
                        alert("Perdu...");
                    }
                    break;
                case 3: // Meds
                    if(state.sick) {
                        state.sick = false;
                        alert("GuÃ©ri !");
                    }
                    break;
                case 4: // Bath
                    state.poop = 0;
                    alert("Propre !");
                    break;
                case 5: // Scale/Stats
                    showStats();
                    break;
                case 6: // Discipline
                    state.discipline = Math.min(100, state.discipline + 10);
                    alert("DisciplinÃ© !");
                    break;
                case 7: // Attention
                    alert("Statut: " + (state.sick ? "Malade" : "OK"));
                    break;
            }
            state.menuIdx = -1; // Deselect after action
            updateUI();
        }

        function showStats() {
            const ov = document.getElementById('overlay');
            const cont = document.getElementById('overlay-content');

            // Build Hearts HTML
            let hHTML = '<div class="hearts-row">Faim: ';
            for(let i=0; i<4; i++) hHTML += `<div class="heart ${i<state.hunger?'full':''}"></div>`;
            hHTML += '</div><div class="hearts-row">Joie: ';
            for(let i=0; i<4; i++) hHTML += `<div class="heart ${i<state.happiness?'full':''}"></div>`;
            hHTML += '</div>';

            cont.innerHTML = `
                <div>AGE: ${Math.floor((Date.now() - state.birthTime)/86400000)}j</div>
                <div>POIDS: ${state.weight}g</div>
                <div>DISC: ${state.discipline}%</div>
                <br>
                ${hHTML}
            `;
            ov.classList.add('active');
        }

        function hideOverlay() {
            document.getElementById('overlay').classList.remove('active');
        }

        function animateAction(text) {
            // Simple visual feedback
            const s = document.getElementById('sprite');
            const prev = s.style.transform;
            s.style.transform = "scale(1.2)";
            setTimeout(() => s.style.transform = prev, 500);
        }

        /* --- SYSTEME --- */
        function toggleMenu() {
            document.getElementById('menu').classList.toggle('active');
        }

        function saveLocal() {
            localStorage.setItem('tama_save', JSON.stringify(state));
        }

        function saveGame() {
            const blob = new Blob([JSON.stringify(state)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'tamagotchi.json';
            a.click();
        }

        function loadGame(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = e => {
                state = JSON.parse(e.target.result);
                updateUI();
            };
            reader.readAsText(file);
        }

        function resetGame() {
            if(confirm("Tout effacer ?")) {
                state = {
                    stage: 'egg', birthTime: Date.now(), lastUpdate: Date.now(),
                    hunger: 2, happiness: 2, weight: 5, discipline: 0,
                    poop: 0, sick: false, sleeping: false, lights: true, menuIdx: -1
                };
                updateUI();
            }
        }

        function changeColor(col) {
            const dev = document.getElementById('device');
            if(col === 'purple') dev.style.background = 'linear-gradient(135deg, #6a5acd, #483d8b)';
            if(col === 'blue') dev.style.background = 'linear-gradient(135deg, #4682b4, #1e90ff)';
            if(col === 'white') dev.style.background = '#f0f0f0';
            if(col === 'trans_pink') dev.style.background = 'rgba(255,105,180,0.6)';
        }

        // Init
        const saved = localStorage.getItem('tama_save');
        if(saved) state = JSON.parse(saved);

        setInterval(loop, 1000); // 1s loop for smoother updates
        updateUI();

    </script>
</body>
</html>
