<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamagotchi Original</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        /* Menu hamburger */
        .hamburger-menu {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .hamburger-btn {
            background: white;
            border: none;
            border-radius: 8px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
            padding: 10px;
        }

        .hamburger-btn span {
            width: 25px;
            height: 3px;
            background: #333;
            border-radius: 2px;
            transition: 0.3s;
        }

        .menu-dropdown {
            display: none;
            position: absolute;
            top: 60px;
            left: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            min-width: 200px;
            overflow: hidden;
        }

        .menu-dropdown.active {
            display: block;
        }

        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        input[type="file"] {
            display: none;
        }

        /* Device Tamagotchi */
        .tamagotchi-device {
            background: linear-gradient(145deg, #ff69b4, #ff1493);
            border-radius: 45% 45% 48% 48% / 45% 45% 42% 42%;
            padding: 25px;
            box-shadow: 
                0 25px 60px rgba(0,0,0,0.4),
                inset 0 -8px 25px rgba(0,0,0,0.15),
                inset 0 3px 15px rgba(255,255,255,0.3);
            max-width: 320px;
            width: 100%;
            position: relative;
        }

        .tamagotchi-device::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 15px;
            background: #ddd;
            border-radius: 50%;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }

        /* √âcran LCD */
        .screen-wrapper {
            background: #e8e8e8;
            border-radius: 15px;
            padding: 12px;
            margin: 30px 0 25px 0;
            box-shadow: 
                inset 0 3px 10px rgba(0,0,0,0.2),
                0 2px 5px rgba(255,255,255,0.5);
            position: relative;
        }

        .screen-border {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 8px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.8);
        }

        .screen {
            background: #9bc700;
            width: 100%;
            height: 200px;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.15);
        }

        .screen.light-off {
            background: #2a4d14;
        }

        /* Ic√¥nes de menu en haut */
        .menu-icons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            padding: 5px;
            background: rgba(0,0,0,0.05);
            gap: 8px;
        }

        .menu-icon {
            text-align: center;
            font-size: 20px;
            padding: 4px;
            border-radius: 4px;
            opacity: 0.4;
            transition: 0.2s;
        }

        .menu-icon.selected {
            opacity: 1;
            background: rgba(0,0,0,0.2);
        }

        /* Zone de jeu */
        .game-area {
            height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .pet {
            font-size: 60px;
            animation: bounce 2s ease-in-out infinite;
            filter: drop-shadow(1px 1px 0 rgba(0,0,0,0.2));
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.05); }
        }

        .skull {
            animation: fade 1.5s ease-in-out infinite;
        }

        @keyframes fade {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .poop {
            position: absolute;
            font-size: 20px;
            bottom: 15px;
        }

        .hearts-display {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 11px;
            line-height: 1.4;
        }

        .heart-line {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .heart {
            font-size: 10px;
        }

        .info-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(155, 199, 0, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px;
            font-size: 11px;
            font-weight: bold;
        }

        .info-overlay.active {
            display: flex;
        }

        .info-row {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
            padding: 2px 5px;
        }

        .feed-menu {
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .feed-menu.active {
            display: flex;
        }

        .feed-option {
            font-size: 35px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            opacity: 0.5;
        }

        .feed-option.selected {
            opacity: 1;
            background: rgba(0,0,0,0.1);
        }

        .message-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            display: none;
        }

        .message-popup.active {
            display: block;
        }

        .sleep-zzz {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 25px;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .age-info {
            position: absolute;
            bottom: 8px;
            right: 8px;
            font-size: 10px;
            font-weight: bold;
        }

        /* Boutons A, B, C */
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 35px;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        .tama-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            font-family: 'Courier New', monospace;
            box-shadow: 
                0 6px 0 rgba(0,0,0,0.3),
                0 8px 15px rgba(0,0,0,0.2),
                inset 0 -3px 8px rgba(0,0,0,0.2);
            transition: all 0.1s;
            position: relative;
            top: 0;
        }

        .tama-btn:active {
            top: 4px;
            box-shadow: 
                0 2px 0 rgba(0,0,0,0.3),
                0 4px 8px rgba(0,0,0,0.2),
                inset 0 -3px 8px rgba(0,0,0,0.2);
        }

        .btn-a {
            background: linear-gradient(145deg, #ffd700, #ffed4e);
        }

        .btn-b {
            background: linear-gradient(145deg, #ff6347, #ff8570);
        }

        .btn-c {
            background: linear-gradient(145deg, #4169e1, #6a8aff);
        }

        .btn-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .game-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 10px;
        }

        .game-screen.active {
            display: flex;
        }

        .game-options {
            display: flex;
            gap: 20px;
        }

        .game-choice {
            font-size: 40px;
            opacity: 0.4;
        }

        .game-choice.selected {
            opacity: 1;
            animation: pulse 0.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <!-- Menu Hamburger -->
    <div class="hamburger-menu">
        <button class="hamburger-btn" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="menu-dropdown" id="menu-dropdown">
            <div class="menu-item" onclick="exportToJSON()">
                üì• Exporter JSON
            </div>
            <label class="menu-item" for="import-file">
                üì§ Importer JSON
            </label>
            <div class="menu-item" onclick="resetPet()">
                üîÑ Nouveau Tamagotchi
            </div>
        </div>
    </div>
    <input type="file" id="import-file" accept=".json" onchange="importFromJSON(event)">

    <!-- Device Tamagotchi -->
    <div class="tamagotchi-device">
        <div class="screen-wrapper">
            <div class="screen-border">
                <div class="screen" id="screen">
                    <!-- Ic√¥nes de menu -->
                    <div class="menu-icons" id="menu-icons">
                        <div class="menu-icon" data-index="0">üçñ</div>
                        <div class="menu-icon" data-index="1">üí°</div>
                        <div class="menu-icon" data-index="2">üéÆ</div>
                        <div class="menu-icon" data-index="3">üíä</div>
                        <div class="menu-icon" data-index="4">üöΩ</div>
                        <div class="menu-icon" data-index="5">üìä</div>
                        <div class="menu-icon" data-index="6">üìè</div>
                    </div>

                    <!-- Zone principale -->
                    <div class="game-area" id="game-area">
                        <div class="hearts-display">
                            <div class="heart-line">
                                <span>üçñ</span>
                                <span id="hunger-hearts"></span>
                            </div>
                            <div class="heart-line">
                                <span>üòä</span>
                                <span id="happy-hearts"></span>
                            </div>
                        </div>
                        <div class="pet" id="pet">ü•ö</div>
                        <div class="age-info" id="age-info">0h</div>
                    </div>

                    <!-- Menu Feed -->
                    <div class="feed-menu" id="feed-menu">
                        <div class="feed-option" data-type="meal">üçñ</div>
                        <div class="feed-option" data-type="snack">üç∞</div>
                    </div>

                    <!-- √âcran Stats -->
                    <div class="info-overlay" id="stats-screen">
                        <div class="info-row">
                            <span>√ÇGE:</span>
                            <span id="stat-age">0h</span>
                        </div>
                        <div class="info-row">
                            <span>POIDS:</span>
                            <span id="stat-weight">5g</span>
                        </div>
                        <div class="info-row">
                            <span>SANT√â:</span>
                            <span id="stat-health">100%</span>
                        </div>
                        <div class="info-row">
                            <span>STADE:</span>
                            <span id="stat-stage">≈íuf</span>
                        </div>
                    </div>

                    <!-- √âcran Discipline -->
                    <div class="info-overlay" id="disc-screen">
                        <div class="info-row">
                            <span>DISCIPLINE</span>
                        </div>
                        <div class="info-row">
                            <span id="disc-value">0%</span>
                        </div>
                    </div>

                    <!-- √âcran de jeu -->
                    <div class="game-screen" id="game-screen">
                        <div style="font-size: 14px; font-weight: bold;">GAUCHE ou DROITE?</div>
                        <div class="game-options">
                            <div class="game-choice" data-dir="left">‚¨ÖÔ∏è</div>
                            <div class="game-choice" data-dir="right">‚û°Ô∏è</div>
                        </div>
                    </div>

                    <!-- Message popup -->
                    <div class="message-popup" id="message-popup"></div>
                </div>
            </div>
        </div>

        <!-- Boutons A, B, C -->
        <div class="control-buttons">
            <button class="tama-btn btn-a" onclick="handleButtonA()">
                A
                <span class="btn-label">SELECT</span>
            </button>
            <button class="tama-btn btn-b" onclick="handleButtonB()">
                B
                <span class="btn-label">DECIDE</span>
            </button>
            <button class="tama-btn btn-c" onclick="handleButtonC()">
                C
                <span class="btn-label">CANCEL</span>
            </button>
        </div>
    </div>

    <script>
        let tamagotchi = {
            stage: 'egg',
            age: 0,
            hunger: 4,
            happiness: 4,
            weight: 5,
            discipline: 0,
            health: 100,
            isSick: false,
            poopCount: 0,
            isSleeping: false,
            lightOn: true,
            lastUpdate: Date.now(),
            birthTime: Date.now(),
            careErrors: 0
        };

        const stageSprites = {
            egg: 'ü•ö', baby: 'üê£', child: 'üê•', 
            teen: 'üê§', adult: 'üê¶', good_adult: 'ü¶ú', 
            perfect_adult: 'ü¶ö', dead: 'üíÄ'
        };

        const stageNames = {
            egg: '≈íuf', baby: 'B√©b√©', child: 'Enfant',
            teen: 'Ado', adult: 'Adulte', good_adult: 'Bon',
            perfect_adult: 'Parfait', dead: 'Mort'
        };

        let currentMenu = -1; // -1 = aucun menu
        let currentSubMenu = 0;
        let gameCorrectAnswer = '';

        // Menu hamburger
        function toggleMenu() {
            document.getElementById('menu-dropdown').classList.toggle('active');
        }

        // Fermer le menu si on clique ailleurs
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.hamburger-menu')) {
                document.getElementById('menu-dropdown').classList.remove('active');
            }
        });

        // Bouton A - S√©lection
        function handleButtonA() {
            if (currentMenu === -1) {
                // Navigation dans le menu principal
                currentMenu = (currentMenu + 1) % 7;
                updateMenuSelection();
            } else if (currentMenu === 0) {
                // Menu Feed - alterner entre meal et snack
                currentSubMenu = (currentSubMenu + 1) % 2;
                updateFeedSelection();
            } else if (currentMenu === 2) {
                // Menu Game - alterner choix
                currentSubMenu = (currentSubMenu + 1) % 2;
                updateGameSelection();
            } else {
                // Passer au menu suivant
                currentMenu = (currentMenu + 1) % 7;
                closeAllScreens();
                updateMenuSelection();
            }
        }

        // Bouton B - Confirmation
        function handleButtonB() {
            if (currentMenu === -1) {
                // Ouvrir le premier menu
                currentMenu = 0;
                updateMenuSelection();
            } else {
                executeMenuAction();
            }
        }

        // Bouton C - Annulation
        function handleButtonC() {
            currentMenu = -1;
            currentSubMenu = 0;
            closeAllScreens();
            updateMenuSelection();
        }

        // Mettre √† jour la s√©lection du menu
        function updateMenuSelection() {
            const icons = document.querySelectorAll('.menu-icon');
            icons.forEach((icon, index) => {
                icon.classList.toggle('selected', index === currentMenu);
            });
        }

        // Fermer tous les √©crans
        function closeAllScreens() {
            document.getElementById('feed-menu').classList.remove('active');
            document.getElementById('stats-screen').classList.remove('active');
            document.getElementById('disc-screen').classList.remove('active');
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('game-area').style.display = 'flex';
        }

        // Ex√©cuter l'action du menu
        function executeMenuAction() {
            if (tamagotchi.stage === 'dead') {
                showMessage('üíÄ RIP');
                return;
            }

            switch(currentMenu) {
                case 0: // Feed
                    if (!document.getElementById('feed-menu').classList.contains('active')) {
                        closeAllScreens();
                        document.getElementById('game-area').style.display = 'none';
                        document.getElementById('feed-menu').classList.add('active');
                        updateFeedSelection();
                    } else {
                        // Confirmer le choix
                        if (currentSubMenu === 0) {
                            feed();
                        } else {
                            giveSnack();
                        }
                        handleButtonC();
                    }
                    break;
                case 1: // Light
                    toggleLight();
                    break;
                case 2: // Game
                    if (!document.getElementById('game-screen').classList.contains('active')) {
                        startGame();
                    } else {
                        playGame();
                    }
                    break;
                case 3: // Medicine
                    giveMedicine();
                    break;
                case 4: // Bathroom
                    clean();
                    break;
                case 5: // Stats
                    closeAllScreens();
                    document.getElementById('stats-screen').classList.add('active');
                    updateStatsDisplay();
                    break;
                case 6: // Discipline
                    closeAllScreens();
                    document.getElementById('disc-screen').classList.add('active');
                    document.getElementById('disc-value').textContent = tamagotchi.discipline + '%';
                    break;
            }
        }

        // Mettre √† jour la s√©lection Feed
        function updateFeedSelection() {
            const options = document.querySelectorAll('.feed-option');
            options.forEach((opt, index) => {
                opt.classList.toggle('selected', index === currentSubMenu);
            });
        }

        // D√©marrer le jeu
        function startGame() {
            if (tamagotchi.stage === 'egg' || tamagotchi.isSleeping) {
                showMessage('Impossible');
                return;
            }
            closeAllScreens();
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('game-screen').classList.add('active');
            gameCorrectAnswer = Math.random() < 0.5 ? 'left' : 'right';
            currentSubMenu = 0;
            updateGameSelection();
        }

        // Mettre √† jour la s√©lection du jeu
        function updateGameSelection() {
            const choices = document.querySelectorAll('.game-choice');
            choices.forEach((choice, index) => {
                choice.classList.toggle('selected', index === currentSubMenu);
            });
        }

        // Jouer
        function playGame() {
            const playerChoice = currentSubMenu === 0 ? 'left' : 'right';
            const won = playerChoice === gameCorrectAnswer;

            if (won) {
                tamagotchi.happiness = Math.min(4, tamagotchi.happiness + 1);
                tamagotchi.weight = Math.max(1, tamagotchi.weight - 1);
                tamagotchi.discipline = Math.min(100, tamagotchi.discipline + 5);
                showMessage('üéâ GAGN√â!');
            } else {
                showMessage('üò¢ PERDU');
            }

            handleButtonC();
            updateDisplay();
            saveToLocalStorage();
        }

        // Nourrir
        function feed() {
            if (tamagotchi.hunger < 4) {
                tamagotchi.hunger = Math.min(4, tamagotchi.hunger + 1);
                tamagotchi.weight += 1;
                showMessage('üçñ Miam!');
                updateDisplay();
                saveToLocalStorage();
            } else {
                showMessage('Pas faim');
            }
        }

        // Snack
        function giveSnack() {
            if (tamagotchi.happiness < 4) {
                tamagotchi.happiness = Math.min(4, tamagotchi.happiness + 1);
                tamagotchi.weight += 2;
                showMessage('üç∞ Yum!');
                updateDisplay();
                saveToLocalStorage();
            } else {
                showMessage('Assez!');
            }
        }

        // Nettoyer
        function clean() {
            if (tamagotchi.poopCount > 0) {
                tamagotchi.poopCount = 0;
                showMessage('‚ú® Propre!');
                updateDisplay();
                saveToLocalStorage();
            } else {
                showMessage('D√©j√† propre');
            }
        }

        // M√©decine
        function giveMedicine() {
            if (tamagotchi.isSick) {
                tamagotchi.isSick = false;
                tamagotchi.health = Math.min(100, tamagotchi.health + 20);
                showMessage('üíä Gu√©ri!');
                updateDisplay();
                saveToLocalStorage();
            } else {
                showMessage('Pas malade');
            }
        }

        // Lumi√®re
        function toggleLight() {
            tamagotchi.lightOn = !tamagotchi.lightOn;
            if (!tamagotchi.lightOn) {
                tamagotchi.isSleeping = true;
                showMessage('üí§ Dodo');
            } else {
                const hour = new Date().getHours();
                if (hour < 21 && hour >= 8) {
                    tamagotchi.isSleeping = false;
                }
                showMessage('üí° Allum√©');
            }
            updateDisplay();
            saveToLocalStorage();
        }

        // Afficher message
        function showMessage(msg) {
            const popup = document.getElementById('message-popup');
            popup.textContent = msg;
            popup.classList.add('active');
            setTimeout(() => popup.classList.remove('active'), 1500);
        }

        // Mettre √† jour l'affichage
        function updateDisplay() {
            // Hearts
            const hungerEl = document.getElementById('hunger-hearts');
            const happyEl = document.getElementById('happy-hearts');
            hungerEl.innerHTML = '‚ô•'.repeat(tamagotchi.hunger) + '‚ô°'.repeat(4 - tamagotchi.hunger);
            happyEl.innerHTML = '‚ô•'.repeat(tamagotchi.happiness) + '‚ô°'.repeat(4 - tamagotchi.happiness);

            // Pet sprite
            const petEl = document.getElementById('pet');
            const gameArea = document.getElementById('game-area');

            // Nettoyer
            document.querySelectorAll('.poop').forEach(p => p.remove());
            document.querySelectorAll('.sleep-zzz').forEach(s => s.remove());

            if (tamagotchi.stage === 'dead') {
                petEl.textContent = stageSprites.dead;
                petEl.className = 'pet skull';
            } else {
                petEl.textContent = tamagotchi.isSick ? 'ü§í' : stageSprites[tamagotchi.stage];
                petEl.className = 'pet';

                // Cacas
                for (let i = 0; i < tamagotchi.poopCount; i++) {
                    const poop = document.createElement('div');
                    poop.className = 'poop';
                    poop.textContent = 'üí©';
                    poop.style.left = (10 + i * 22) + '%';
                    gameArea.appendChild(poop);
                }

                // Sommeil
                if (tamagotchi.isSleeping) {
                    const zzz = document.createElement('div');
                    zzz.className = 'sleep-zzz';
                    zzz.textContent = 'Zzz';
                    gameArea.appendChild(zzz);
                }
            }

            // √âcran
            document.getElementById('screen').classList.toggle('light-off', !tamagotchi.lightOn);

            // Age
            document.getElementById('age-info').textContent = tamagotchi.age + 'h';
        }

        // Mettre √† jour l'√©cran stats
        function updateStatsDisplay() {
            document.getElementById('stat-age').textContent = tamagotchi.age + 'h';
            document.getElementById('stat-weight').textContent = tamagotchi.weight + 'g';
            document.getElementById('stat-health').textContent = tamagotchi.health + '%';
            document.getElementById('stat-stage').textContent = stageNames[tamagotchi.stage];
        }

        // Boucle de jeu
        function gameLoop() {
            if (tamagotchi.stage === 'dead') return;

            const now = Date.now();
            const timeDiff = now - tamagotchi.lastUpdate;
            const minutesPassed = Math.floor(timeDiff / 60000);

            if (minutesPassed > 0 && tamagotchi.stage !== 'egg') {
                if (!tamagotchi.isSleeping) {
                    if (minutesPassed >= 5) tamagotchi.hunger = Math.max(0, tamagotchi.hunger - 1);
                    if (minutesPassed >= 7) tamagotchi.happiness = Math.max(0, tamagotchi.happiness - 1);
                    if (Math.random() < 0.3 && tamagotchi.poopCount < 4) tamagotchi.poopCount++;
                    if (tamagotchi.poopCount >= 2 && Math.random() < 0.4) {
                        tamagotchi.isSick = true;
                        tamagotchi.health = Math.max(0, tamagotchi.health - 10);
                    }
                    if (tamagotchi.health <= 0) tamagotchi.stage = 'dead';
                    if (tamagotchi.hunger === 0 || tamagotchi.happiness === 0) {
                        tamagotchi.careErrors++;
                        tamagotchi.health = Math.max(0, tamagotchi.health - 5);
                    }
                }
                tamagotchi.lastUpdate = now;
            }

            checkAge();
            checkEvolution();
            updateDisplay();
            saveToLocalStorage();
        }

        // V√©rifier l'√¢ge
        function checkAge() {
            tamagotchi.age = Math.floor((Date.now() - tamagotchi.birthTime) / 3600000);
        }

        // V√©rifier l'√©volution
        function checkEvolution() {
            if (tamagotchi.stage === 'egg' && tamagotchi.age >= 0.02) {
                tamagotchi.stage = 'baby';
                showMessage('‚ú® B√âB√â!');
            } else if (tamagotchi.stage === 'baby' && tamagotchi.age >= 1) {
                tamagotchi.stage = 'child';
                showMessage('‚ú® ENFANT!');
            } else if (tamagotchi.stage === 'child' && tamagotchi.age >= 3) {
                tamagotchi.stage = 'teen';
                showMessage('‚ú® ADO!');
            } else if (tamagotchi.stage === 'teen' && tamagotchi.age >= 5) {
                if (tamagotchi.careErrors === 0 && tamagotchi.discipline >= 75) {
                    tamagotchi.stage = 'perfect_adult';
                } else if (tamagotchi.careErrors <= 2) {
                    tamagotchi.stage = 'good_adult';
                } else {
                    tamagotchi.stage = 'adult';
                }
                showMessage('‚ú® ADULTE!');
            }
        }

        // Sauvegarder
        function saveToLocalStorage() {
            localStorage.setItem('tamagotchi', JSON.stringify(tamagotchi));
        }

        // Charger
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('tamagotchi');
            if (saved) {
                tamagotchi = JSON.parse(saved);
                const now = Date.now();
                const minutesPassed = Math.floor((now - tamagotchi.lastUpdate) / 60000);

                if (minutesPassed > 0 && tamagotchi.stage !== 'dead' && tamagotchi.stage !== 'egg') {
                    tamagotchi.hunger = Math.max(0, tamagotchi.hunger - Math.floor(minutesPassed / 5));
                    tamagotchi.happiness = Math.max(0, tamagotchi.happiness - Math.floor(minutesPassed / 7));
                    tamagotchi.poopCount = Math.min(4, tamagotchi.poopCount + Math.floor(minutesPassed / 30));

                    if (tamagotchi.poopCount >= 2 && minutesPassed > 60) {
                        tamagotchi.isSick = true;
                        tamagotchi.health = Math.max(0, tamagotchi.health - 20);
                    }

                    if (minutesPassed > 300 && tamagotchi.hunger === 0) {
                        tamagotchi.stage = 'dead';
                        tamagotchi.health = 0;
                    }
                }
                tamagotchi.lastUpdate = now;
            }
        }

        // Export JSON
        function exportToJSON() {
            const dataStr = JSON.stringify(tamagotchi, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `tamagotchi_${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showMessage('üíæ Export√©!');
        }

        // Import JSON
        function importFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    tamagotchi = JSON.parse(e.target.result);
                    tamagotchi.lastUpdate = Date.now();
                    saveToLocalStorage();
                    updateDisplay();
                    showMessage('üìÇ Import√©!');
                } catch {
                    alert('Fichier invalide');
                }
            };
            reader.readAsText(file);
        }

        // R√©initialiser
        function resetPet() {
            if (confirm('Nouveau Tamagotchi?')) {
                tamagotchi = {
                    stage: 'egg', age: 0, hunger: 4, happiness: 4,
                    weight: 5, discipline: 0, health: 100, isSick: false,
                    poopCount: 0, isSleeping: false, lightOn: true,
                    lastUpdate: Date.now(), birthTime: Date.now(), careErrors: 0
                };
                saveToLocalStorage();
                updateDisplay();
                showMessage('ü•ö Nouveau!');
            }
        }

        // Init
        window.onload = () => {
            loadFromLocalStorage();
            updateDisplay();
            setInterval(gameLoop, 30000);
        };
    </script>
</body>
</html>